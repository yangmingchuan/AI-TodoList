---
description: 功能实现规范
globs: ["**/*.ts", "**/*.tsx"]
alwaysApply: true
---

# 功能实现规范

功能实现规范可以包含重要的长期迭代规则，如项目架构、组件规范、API调用规范、日志规范等，用于统一架构、优化性能、方便问题排查。

## React 组件规范

- 使用函数式组件 + Hooks，禁止使用类组件
- Props 必须定义 interface 类型
- 复杂计算使用 `useMemo`/`useCallback` 优化性能
- 使用自定义 Hooks 提取可复用逻辑

## 状态管理

- 组件内部状态: `useState`
- 跨组件状态: `useContext` 或状态管理库
- 禁止在组件内直接修改 props

## API 调用规范

- 异步操作必须包含错误处理 (`try/catch` 或 `.catch()`)
- 使用统一的请求工具函数 (如 `@/utils/request`)
- 响应数据必须使用类型包装
- 禁止在组件内直接调用第三方 API 库

## 错误处理

- 所有异步操作必须捕获错误
- 使用错误边界包装页面组件
- 禁止吞掉异常，必须记录或抛出

## 性能优化

- 大列表使用虚拟化技术
- 图片使用懒加载
- 避免在渲染函数中进行复杂计算
- 使用 `React.memo` 包装纯展示组件

## 测试规范

- 关键功能必须有单元测试
- 测试文件命名: `{{ComponentName}}.test.tsx`
- 使用 `describe` + `it` 结构组织测试用例
- 测试覆盖率不低于 80%

## 代码质量

- 禁止使用 `console.log` 生产环境
- 避免魔法数字，使用常量定义
- 函数长度不超过 50 行
- 文件大小不超过 500 行
